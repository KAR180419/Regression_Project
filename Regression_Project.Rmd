---
title: "Regression Project"
author: "Sai Nivas Rangaraju, Anmol Rao Karukonda"
date: "2024-11-11"
output: html_document
---

# Reading Data into dataframe

```{r}
data <- read.csv('insurance.csv')
head(data)
```

# Identifying Response and Predictor Variable and their types

Predictor variables:

  Categorical : sex, smoker, region
  
  Continuous : age, bmi, children
  
Response variable : charges

# Fitting a multiple linear regression model on all the variables

```{r}
lin_model <- lm(charges~., data = data)
summary(lin_model)
```



```{r}
lin_model2 <- lm(charges ~ (.-sex-region), data = data)
summary(lin_model2)
```

```{r}
plot(lin_model2)
```


```{r}
library(lmtest)
bptest(lin_model2)
```
The Breusch-Pagan (BP) test indicates that there is heteroscedasticity in the data. So, we proceed to transform the data.


# Log Transformation

```{r}
log_model <- lm(log(charges) ~ age+bmi+children+smoker,data=data)
summary(log_model)
plot(log_model)
```

```{r}
bptest(log_model)
```
This is indicating that even with the log-transform the heteroscedasticity is still present, so we use square transform.


```{r}
model_square <- lm((charges^2) ~ age+bmi+children+smoker,data=data)
summary(model_square)

plot(model_square)
```
```{r}
bptest(model_square)
```
This also did not help much with the heteroscedasticity.

```{r}
weights <- 1 / lm(abs(residuals(lin_model2)) ~ fitted(lin_model2))$fitted.values^2

model_wls <- lm(charges ~ age + bmi + children + smoker, data = data, weights = weights)
summary(model_wls)
plot(model_wls)
```

```{r}
bptest(model_wls)
```

```{r}
model <- lm(charges ~ age+bmi+children+smoker+bmi*smoker, data = data)
summary(model)
```

```{r}
plot(model)
```


```{r}
bptest(model)
```

